<!DOCTYPE html> 
<html> 
<body> 

<style>
body{
  background: url("bg.png") no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}

.center {    margin-left: auto;
    margin-right: auto;
    text-align: center;
    display: block; }


</style>

<video class="center" id="myVideo" width="720" height="176" controls>
  <source src="" type="audio/mp3">
  Your browser does not support HTML5 video.
</video>
<button class="center" style="width:200px;height:30px;" onclick="playFromTimestamp()" type="button">Play from timestamp</button>

<!-- for PSAs-->
<span class="center" id="message" style="color:white;">Loading...</span>

<script>
var vid = document.getElementById("myVideo");
var msg = document.getElementById("message");

function load() {
    var pod_url = getQueryVariable("url");
    var proxy_url = "https://cors.io/?" + pod_url + "?format=json";

    var request = new XMLHttpRequest();
    request.open('GET', proxy_url, true);
    request.send(null);
    request.onreadystatechange = function () {
        if (request.readyState === 4) {
            if (request.status === 200) {
                var text = request.responseText;
                var doc = new DOMParser().parseFromString(text, 'text/html');
                var result = doc.evaluate("/html/head/meta[@property='og:audio']/@content", doc, null, XPathResult.STRING_TYPE, null);
                var file_url = (result.stringValue);

                vid.setAttribute("src", file_url);
                vid.currentTime=Number(getQueryVariable("time"));

                vid.oncanplay = function() {
                    vid.play();
                    msg.textContent = "";
                };
            } else {
                msg.textContent = "CORS proxy is down. if this happens a lot ill switch proxies";
            }
        }
    };
}

function playFromTimestamp() {
  vid.currentTime=Number(getQueryVariable("time"));
  vid.play();
}

function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
}


window.onload = load;
</script> 

</body> 
</html>
